<!DOCTYPE html>
<html>

  <head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  <title>Typescript - Web API error handler « ASD</title>
  
  
    <meta name="description" content="Flexible module to manage an arising Web API error messages and notify about that via special handler. It is a useful thing on development mode, when you oft...">    
  

  <link rel="stylesheet" href="/css/main.css">
  <link rel="stylesheet" href="/css/custom.css">
  <link rel="canonical" href="http://asduser.github.io/typescript/web-api-error-handler">
  <link rel="alternate" type="application/rss+xml" title="ASD" href="http://asduser.github.io/feed.xml" />
  <link rel="shortcut icon" type="image/png" href="/images/3066.png">

  <!-- <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css" />
  <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
  <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script> -->
  <link rel="stylesheet" href="//code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css">
  <script src="//code.jquery.com/jquery-1.10.2.js"></script>
  <script src="//code.jquery.com/ui/1.11.4/jquery-ui.js"></script>
</head>


  <body>

    <header class="header">
  <div class="wrapper">
    <a class="site-title" href="/">ASD</a>
    <nav class="site-nav">
      <!-- 
        
      
        
        <a class="page-link" href="/about/">About me</a>
        
      
        
        <a class="page-link" href="/category/">Category</a>
        
      
        
      
        
      
        
      
        
        <a class="page-link" href="/publications">Publications</a>
        
      
        
        <a class="page-link" href="/works">Works</a>
        
      
        
       -->            
      <a class="page-link" href="/works">Works</a>      
      <a class="page-link" href="/publications">Publications</a>
      <a class="page-link" href="/">Blog</a>
      <a class="page-link" href="/about">About</a>
    </nav>
  </div>
</header>

    <div class="page-content">
      <div class="wrapper">
        <div class="col-main">
          <div class="post">

  <header class="post-header">
    <h1 class="post-title">Typescript - Web API error handler</h1>
    <p class="post-meta">Jul 3, 2016</p>
  </header>

  <article class="post-content">
    <p>Flexible module to manage an arising Web API error messages and notify about that via special handler. It is a useful thing on development mode, when you often need a supplemental descrption message.</p>

<p><a href="https://github.com/asduser/typescript-practice/tree/master/web-api-error-handler">Download an example project from github.</a></p>

<p><a href="https://github.com/asduser/typescript-practice/tree/master/web-api-error-handler" class="github-button">Open repository</a></p>

<h2 id="declare-a-main-scrope">Declare a main scrope</h2>

<p>To stat with, create an individual space for module to avoid any possible issues in the future. In this case, it will be working using a <em>namespace</em> key.</p>

<p>Moreover, we’re going to work with references injections, so a main file has the following style:</p>

<div align="right" class="highlighter-file-title">Core.ts</div>
<pre><code class="language-ts">
/// &lt;reference path="Enum/State.ts"/&gt;
/// &lt;reference path="Enum/Message.ts"/&gt;
/// &lt;reference path="Interface/ILogger.ts"/&gt;
/// &lt;reference path="Interface/IDispatcher.ts"/&gt;
/// &lt;reference path="Dispatcher.ts"/&gt;

namespace ApiErrorHandler {}

</code></pre>

<p>As you see, nothing special, just declaring the main project files there. Nevertheless, there was declared <strong>namespace ApiErrorHandler</strong> to simplify project navigation.</p>

<p>You open this file, then find the line with announced namespace line and thereafter you may be aware of why it was created and which items it contains.</p>

<h2 id="project-structure">Project structure</h2>

<div align="right" class="highlighter-file-title">Project structure</div>
<p><img src="/images/post/ts-api-error-handler-1-project.png" alt="project architecture" /></p>

<p>Let’s talk about each directory separately.</p>

<ol>
  <li><strong>js</strong> - contains concatenated output.js file.</li>
  <li><strong>ts\ApiErrorHandler</strong> - our future module located there.</li>
  <li><strong>ts\ApiErrorHandler\Enum</strong> - a different TypeScript enum files.</li>
  <li><strong>ts\ApiErrorHandler\Interface</strong> - interfaces to work with classes.</li>
  <li><strong>ts\ApiErrorHandler\Core.ts</strong> - includes all *.ts references.</li>
  <li><strong>ts\ApiErrorHandler\Dispatcher.ts</strong> - the main file, which contains a diffrerent logical blocks.</li>
</ol>

<p>But we have another one - <strong>ts\main.ts</strong>. It’s independent from <em>ApiErrorHandler</em> file where we can create a diffrerent instances, entities, change our module configuration etc.</p>

<p>To compile a new <em>output.js</em> file use command:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>tsc --out js/output.js ts/main.ts
</code></pre>
</div>

<p>or with *.map file:</p>

<div class="language-bash highlighter-rouge"><pre class="highlight"><code>tsc --sourcemap --out js/output.js ts/main.ts
</code></pre>
</div>

<h2 id="interfaces">Interfaces</h2>

<p>We have 2 interfaces in our app:</p>

<div align="right" class="highlighter-file-title">IDispatcher.ts</div>
<pre><code class="language-typescript">/// &lt;reference path="../Core.ts"/&gt;

namespace ApiErrorHandler {

  export interface IDispatcher {
    isSuccess(response: any, headers?: any, config?: any): boolean;
  }

}
</code></pre>

<div align="right" class="highlighter-file-title">ILogger.ts</div>
<pre><code class="language-typescript">/// &lt;reference path="../Core.ts"/&gt;

namespace ApiErrorHandler {

  // Inherited class may contain either on of console methods or custom :void handler.
  export interface ILogger {
    Show(Entity: any): void;
  }

}
</code></pre>

<p>The first one is responsible for ApiErrorHandler behaviour, as to the another one - it contains action list for Logger.</p>

<p><em>Logger</em> is the common feature to work with messages, particularly with Web Api errors. So, you may specify any handler there (console, alert or smth else) and use in development mode.</p>

<h2 id="enums">Enums</h2>

<p>In order to take out the common constant variables into separate files, we’ll use TypeScript <strong>enum</strong>.</p>

<div align="right" class="highlighter-file-title">Status.ts</div>
<pre><code class="language-typescript">/// &lt;reference path="../Core.ts"/&gt;

namespace ApiErrorHandler {

  export enum State {
    BadRequest = 400,
    UnAuthorized = 401,
    NotFound = 404,
    ServerError = 500
  }

}
</code></pre>

<div align="right" class="highlighter-file-title">Message.ts</div>
<pre><code class="language-typescript">/// &lt;reference path="../Core.ts"/&gt;

namespace ApiErrorHandler {

  export const Message = {
    BadRequest: "Request has a lexical error in URI.",
    UnAuthorized: "Authorization token has been expired.",
    NotFound: "An attempt to send a request to non-exsting route.",
    ServerError: "Unexpected server error - 500.",
    ConnectionError: "Cannot establish connection with server."
  };

}
</code></pre>

<p>And now we may use any status as a constant variable and if we need to change value - just open <strong>Status.ts</strong> file and then modify an appropriate field.</p>

<h2 id="dispatcher-class">“Dispatcher” class</h2>

<p>We come to the main point - <strong>Dispatcher.ts</strong> file, where besides IDispatcher interface implementation declared the next classes:</p>

<ol>
  <li><strong>ErrorHandlerConfig</strong> - to create a new ErrorHandler configuration.</li>
  <li><strong>DefaultLogger</strong> - class which exposes the ILogger functionality and define a default behaviour for it.</li>
</ol>

<div align="right" class="highlighter-file-title">class ErrorHandlerConfig in Dispatcher.ts</div>
<pre><code class="language-typescript">// Config to manage handler behaviour.
  class ErrorHandlerConfig {
    private Logger: ILogger = new DefaultLogger();
    public showErrors: boolean = true;

    public LogMessage = (Entity: any): void =&gt; {
      this.Logger.Show(Entity);
    }

    public SetLogger(logger: ILogger): void {
      this.Logger = logger;
    }
  }
</code></pre>

<div align="right" class="highlighter-file-title">class DefaultLogger in Dispatcher.ts</div>
<pre><code class="language-typescript">// Default logger to handle error messages.
  class DefaultLogger implements ILogger {
    public Show(Entity: any): void {
      console.error(Entity);
    }
  }
</code></pre>

<h2 id="server-response-validation">Server response validation</h2>

<p>Supposing we sent some request to server and have an appropriate response (usually JSON-format). Of course, that response contains the common fields “Status”, “Message” and “Data”. And then, inside appliaction we have to call suitable scenario depending on received status code.</p>

<p>For example:</p>

<ul>
  <li><em>status: 200</em> - all is ok</li>
  <li><em>status: 400, 401, 404, 500</em> etc. - avoid code execution and throw a specific message with error description.</li>
</ul>

<p>Real application:</p>

<pre><code class="language-typescript">$http.get(someUrl).success((response, status, headers, config) =&gt; {
  if( dispatcher.isSuccess(response) ) {
    // actions when succeeded
  }
  // ...
</code></pre>

<p>You may set your own any number of rules in Dispatcher class for each specific situation:</p>

<pre><code class="language-typescript">if (response.Status === State.ServerError) {
  this.Config.showErrors &amp;&amp; this.Config.LogMessage(`Status: ${Message.ServerError}`);
  return false;
}
</code></pre>

<p>In the code above we’ll show default message from our “<em>Message.ts</em>” enum if parameter showErrors is enabled. Thereafter, method returns “false”, which prevents any probable code issues in future.</p>

<h2 id="example">Example</h2>

<pre><code class="language-typescript">/// &lt;reference path="ApiErrorHandler/Core.ts" /&gt;

// Use error handler to check input data.
let dispatcher = new ApiErrorHandler.Dispatcher();

// Create a special class for mock.
class MockResponse {
  constructor(public Status?: number, public Message?: string) {}
}
</code></pre>

<ol>
  <li>We initialize a new Dispatcher instance.</li>
  <li>Declared a special MockResponse class which copies a real server response behavior.</li>
</ol>

<pre><code class="language-typescript">class AlertLogger implements ApiErrorHandler.ILogger {
  Show = (entity: any): void =&gt; {
    alert(entity);
  }
}

// Redefine standart message logger to custom.
dispatcher.Config.SetLogger(new Logger());
</code></pre>

<p>Then we created a special class to handle error messages. In this case all messages will be displayed throughout default alert window.</p>

<p>Now let’s create a few data mocks:</p>

<pre><code class="language-typescript">const serverError = new MockResponse(500, "Timeout expired. Database cannot run a procedure.");

// CONNETCION ERROR behavior
dispatcher.isSuccess();
// SERVER ERROR behavior
dispatcher.isSuccess(serverError);
</code></pre>

<p>And you will see in your alert-box an appropriate messages.</p>

<p><img src="/images/post/ts-api-error-handler-2-alert1.png" alt="project architecture" /></p>

<p><img src="/images/post/ts-api-error-handler-2-alert2.png" alt="project architecture" /></p>

<p>Of course, instead a default alert method you may specify any other handler and be sure it will be work the same.</p>

<h2 id="download-github">Download (github)</h2>

<p><a href="https://github.com/asduser/typescript-practice/tree/master/web-api-error-handler">Download an example project from github.</a></p>

<p><a href="https://github.com/asduser/typescript-practice/tree/master/web-api-error-handler" class="github-button">Open repository</a></p>

  </article>
  
  




</div>

        </div>
        <div class="col-second">
          <div class="col-box col-box-author">
  <img class="avatar" src="http://asduser.github.io/images/blog_logo_sidebar.png" alt="Another Software Developer">
  <div class="col-box-title name">Another Software Developer</div>
  <p>Network Development: TypeScript, Node.js, Python, Golang, C.</p>
  <p class="contact">
    
    <!-- <a href="https://github.com/asduser">GitHub</a> -->
    <iframe src="https://ghbtns.com/github-btn.html?user=asduser&type=follow&count=true&size=large" frameborder="0" scrolling="0" width="220px" height="30px"></iframe>
    
    
    
  </p>
</div>

<div class="col-box">
  <div class="col-box-title">Newest Posts</div>
  <ul class="post-list">
    
      <li><a class="post-link" href="/technologies/xmpp-messaging">XMPP Messaging - first experience</a></li>
    
      <li><a class="post-link" href="/tools/robomongo">Robomongo tool for MongoDB</a></li>
    
      <li><a class="post-link" href="/programming/nextitem-previtem-in-array">Next item\previous item in array</a></li>
    
      <li><a class="post-link" href="/typescript/web-api-error-handler">Typescript - Web API error handler</a></li>
    
      <li><a class="post-link" href="/typescript/references-managing">A way to manage TypeScript references</a></li>
    
  </ul>
</div>

<div class="col-box post-toc hide">  
  <div class="col-box-title">TOC</div>
</div>
        </div>
      </div>
    </div>

    <footer class="footer">
<div class="wrapper">
&copy; 2016 Another Software Developer
</div>
</footer>

<script src="/js/easybook.js"></script>
<script src="/js/global-initializations.js"></script>
<script async defer src="https://buttons.github.io/buttons.js"></script>
<script>
	$(document).ready(function(){
		$("pre").each(function(){
			$(this).addClass("prettyprint");
		});
	})
</script>
<script src="https://cdn.rawgit.com/google/code-prettify/master/loader/run_prettify.js?skin=sons-of-obsidian" defer="defer"></script>

  </body>

</html>
